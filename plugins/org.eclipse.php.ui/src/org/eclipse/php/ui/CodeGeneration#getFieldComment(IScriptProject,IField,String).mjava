	/**
	 * Returns the content for a new field comment using the 'field comment'
	 * code template. The returned content is unformatted and is not indented.
	 * 
	 * @param sp
	 *            The compilation unit where the field is contained. The
	 *            compilation unit does not need to exist.
	 * @param fieldType
	 *            The name of the field declared type.
	 * @param fieldName
	 *            The name of the field to which the comment is added.
	 * @param lineDelimiter
	 *            The line delimiter to be used.
	 * @return Returns the new content or <code>null</code> if the code template
	 *         is undefined or empty. The returned content is unformatted and is
	 *         not indented.
	 * @throws CoreException
	 *             Thrown when the evaluation of the code template fails.
	 * @since 3.0
	 */
	public static String getFieldComment(IScriptProject sp, IField field,
			String lineDelimiter) throws CoreException {
		String fieldName = field.getElementName();
		String fieldType = null;
		Boolean isVar = false;
		Program program = null;

		try {
			// XXX: WAIT_NO (instead of WAIT_YES) due bug 466694 and until
			// bug 438661 will be fixed
			program = SharedASTProvider.getAST(field.getSourceModule(),
					SharedASTProvider.WAIT_NO, new NullProgressMonitor());
		} catch (IOException e1) {
		}

		if (program == null) {
			program = generageProgram(field, null);
			if (program == null) {
				return null;
			}
		}

		ASTNode elementAt = program.getElementAt(field.getSourceRange()
				.getOffset());
		ITypeBinding varType = null;
		IVariableBinding resolvedBinding = null;

		if (elementAt instanceof FieldsDeclaration) {
			FieldsDeclaration fieldDeclaration = (FieldsDeclaration) elementAt;
			resolvedBinding = fieldDeclaration.resolveTypeBinding();

			if (null != resolvedBinding) {
				varType = resolvedBinding.getType();
			}
		} else if (elementAt instanceof Variable) {
			isVar = true;

			Variable varDeclaration = (Variable) elementAt;
			if (varDeclaration.getParent() instanceof Assignment) {
				Expression expression = ((Assignment) varDeclaration
						.getParent()).getRightHandSide();
				varType = expression.resolveTypeBinding();
				if (expression instanceof Scalar) {
					Scalar scalar = (Scalar) expression;
					switch (scalar.getScalarType()) {
					case Scalar.TYPE_INT:
						fieldType = "integer"; //$NON-NLS-1$
						break;
					case Scalar.TYPE_STRING:
						fieldType = "string"; //$NON-NLS-1$
						break;
					}
				}

			} else {
				varType = varDeclaration.resolveTypeBinding();
			}
		}

		if (null == fieldType && null != varType) {
			if (varType.isAmbiguous()) {
				fieldType = "Ambiguous"; //$NON-NLS-1$
			} else {
				fieldType = varType.getName();
			}
		}

		if (null == fieldType) {
			fieldType = UNKNOWN_TYPE;
		}
		if (isVar) {
			return StubUtility.getVarComment(sp, fieldType, fieldName,
					lineDelimiter);
		}
		return StubUtility.getFieldComment(sp, fieldType, fieldName,
				lineDelimiter);
	}

