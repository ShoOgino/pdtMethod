	private Set getPHPProjects(ISelection selection) {
		Set phpProjects;
		if (selection instanceof IStructuredSelection && !selection.isEmpty()) {
			Iterator iter = ((IStructuredSelection) selection).iterator();
			phpProjects = new HashSet(((IStructuredSelection) selection).size());

			while (iter.hasNext()) {
				Object selectedElement = iter.next();
				IResource resource = null;
				if (selectedElement instanceof IResource) {
					resource = (IResource) selectedElement;
				} else if (selectedElement instanceof IAdaptable) {
					resource = (IResource) ((IAdaptable) selectedElement).getAdapter(IResource.class);
				}
				if (resource != null) {
					IProject project = resource.getProject();
					try {
						if (project.hasNature(PHPNature.ID)) {
							phpProjects.add(project);
						}
					} catch (CoreException e) {
						PHPUiPlugin.log(e);
					}
				}
			}
		} else {
			phpProjects = EMPTY_SET;
		}
		return phpProjects;
	}

