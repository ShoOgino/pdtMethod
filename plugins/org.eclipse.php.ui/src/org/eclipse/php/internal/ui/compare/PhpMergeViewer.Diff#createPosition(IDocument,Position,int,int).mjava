		Position createPosition(IDocument doc, Position range, int start, int end) {
			try {
				int l = end - start;
				if (range != null) {
					int dl = range.length;
					if (l > dl)
						l = dl;
				} else {
					int dl = doc.getLength();
					if (start + l > dl)
						l = dl - start;
				}

				Position p = null;
				try {
					p = new Position(start, l);
				} catch (RuntimeException ex) {
					// silently ignored
				}

				try {
					doc.addPosition(IDocumentRange.RANGE_CATEGORY, p);
				} catch (BadPositionCategoryException ex) {
					// silently ignored
				}
				return p;
			} catch (BadLocationException ee) {
				// silently ignored
			}
			return null;
		}

