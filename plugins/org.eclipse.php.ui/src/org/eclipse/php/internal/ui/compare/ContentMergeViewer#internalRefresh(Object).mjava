	private void internalRefresh(Object input) {

		IMergeViewerContentProvider content = getMergeContentProvider();
		if (content == null) {
			return;
		}
		Object ancestor = content.getAncestorContent(input);
		boolean oldFlag = fIsThreeWay;
		if (Utilities.isHunk(input)) {
			fIsThreeWay = true;
		} else if (input instanceof ICompareInput)
			fIsThreeWay = (((ICompareInput) input).getKind() & Differencer.DIRECTION_MASK) != 0;
		else
			fIsThreeWay = ancestor != null;

		if (fAncestorItem != null)
			fAncestorItem.setVisible(fIsThreeWay);

		if (fAncestorVisible && oldFlag != fIsThreeWay)
			fComposite.layout(true);

		Object left = content.getLeftContent(input);
		Object right = content.getRightContent(input);
		updateContent(ancestor, left, right);

		// https://bugs.eclipse.org/bugs/show_bug.cgi?id=453799
		// Content provider may be disposed after call to updateContent()
		content = getMergeContentProvider();
		if (content == null) {
			return;
		}

		updateHeader();
		ToolBarManager tbm = CompareViewerPane.getToolBarManager(fComposite.getParent());
		if (tbm != null) {
			updateToolItems();
			tbm.update(true);
			tbm.getControl().getParent().layout(true);
		}

	}

