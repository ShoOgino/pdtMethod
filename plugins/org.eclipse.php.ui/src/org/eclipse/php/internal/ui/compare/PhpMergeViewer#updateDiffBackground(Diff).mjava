	private void updateDiffBackground(Diff diff) {

		if (!fHighlightRanges)
			return;

		if (diff == null || diff.fIsToken)
			return;

		if (fShowCurrentOnly && !isCurrentDiff(diff))
			return;

		Color c = getColor(null, getFillColor(diff));
		if (c == null)
			return;

		if (isThreeWay())
			fAncestor.setLineBackground(diff.fAncestorPos, c);
		fLeft.setLineBackground(diff.fLeftPos, c);
		fRight.setLineBackground(diff.fRightPos, c);
	}

