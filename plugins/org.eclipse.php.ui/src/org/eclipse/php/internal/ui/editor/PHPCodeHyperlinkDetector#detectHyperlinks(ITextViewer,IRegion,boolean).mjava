	/*
	 * @see org.eclipse.jface.text.hyperlink.IHyperlinkDetector#detectHyperlinks(org.eclipse.jface.text.ITextViewer, org.eclipse.jface.text.IRegion, boolean)
	 */
	public IHyperlink[] detectHyperlinks(ITextViewer textViewer, IRegion region, boolean canShowMultipleHyperlinks) {
		if (region == null /*|| canShowMultipleHyperlinks*/)
			return null;

		try {
			IDocument document = textViewer.getDocument();
			if (document instanceof IStructuredDocument) {

				// Find the PHP token region:
				IStructuredDocument sDoc = (IStructuredDocument) document;
				IStructuredDocumentRegion sdRegion = sDoc.getRegionAtCharacterOffset(region.getOffset());
				ITextRegion textRegion = sdRegion.getRegionAtCharacterOffset(region.getOffset());

				ITextRegionCollection container = sdRegion;
				if (textRegion instanceof ITextRegionContainer) {
					container = (ITextRegionContainer) textRegion;
					textRegion = container.getRegionAtCharacterOffset(region.getOffset());
				}

				if (textRegion.getType() == PHPRegionContext.PHP_CONTENT) {
					IPhpScriptRegion phpScriptRegion = (IPhpScriptRegion) textRegion;
					ITextRegion phpToken = phpScriptRegion.getPhpToken(region.getOffset() - container.getStartOffset() - phpScriptRegion.getStart());

					// Check whether the current token is string, if it is - try to resolve file name from this string:
					if (PHPPartitionTypes.isPHPQuotesState(phpToken.getType())) {

						// Skip left parenthesis:
						ITextRegion prevRegion = phpScriptRegion.getPhpToken(phpToken.getStart() - 1);
						if (prevRegion != null) {

							// Check whether this string belongs to some kind of include/require structure:
							//prevRegion = phpScriptRegion.getPhpToken(prevRegion.getStart() - 1);
							if (prevRegion != null/* && isIncludeType(prevRegion.getType())*/) {

								int startOffset = container.getStartOffset() + phpScriptRegion.getStart() + phpToken.getStart();
								int offsetLength = phpToken.getLength();

								// Get the string contents - it's an included file name:
								String fileName = sDoc.get(startOffset, offsetLength);

								// Trim quotes around the filename:
								Matcher quotesMatcher = QUOTES_PATTERN.matcher(fileName);
								fileName = quotesMatcher.replaceAll(""); //$NON-NLS-1$

								// Find the file in the same project:
								IPath path = new Path(fileName);
								IWorkbenchPage page = PHPUiPlugin.getActivePage();
								if (page != null) {
									IEditorPart editor = page.getActiveEditor();
									final PHPStructuredEditor phpEditor = EditorUtility.getPHPStructuredEditor(editor);
									if (phpEditor != null) {
										IFile currentFile = phpEditor.getFile();
										IFile file = currentFile.getParent().getFile(path);
										if (file == null || !file.exists()) {
											IProject currentProject = currentFile.getProject();
											file = currentProject.getFile(path);
										}
										if (file != null && file.exists()) {
											return new IHyperlink[] { new WorkspaceFileHyperlink(new Region(startOffset, offsetLength), file) };
										}
									}
								}

								// Look for the file in other projects:
								IWorkspace workspace = ResourcesPlugin.getWorkspace();
								IWorkspaceRoot root = workspace.getRoot();
								IProject[] projects = root.getProjects();
								for (int i = 0; i < projects.length; ++i) {
									IFile file = projects[i].getFile(path);
									if (file != null && file.exists()) {
										return new IHyperlink[] { new WorkspaceFileHyperlink(new Region(startOffset, offsetLength), file) };
									}
								}

								// Try to open external file:
								File file = new File(fileName);
								if (file.exists()) {
									return new IHyperlink[] { new ExternalFileHyperlink(new Region(startOffset, offsetLength), file) };
								}
							}
						}
					} else { // The current token is not a string - resolve this PHP element
						CodeData[] codeDatas = CodeDataResolver.getInstance().resolve(sDoc, region.getOffset());
						if (codeDatas != null && codeDatas.length != 0) {
							if (codeDatas[0].getUserData() != null) {
								return new IHyperlink[] { new PHPCodeHyperLink(selectWord(document, region.getOffset()), codeDatas) };
							}
						}
					}
				}
			}
		} catch (Exception e) {
			return null;
		}
		return null;
	}

