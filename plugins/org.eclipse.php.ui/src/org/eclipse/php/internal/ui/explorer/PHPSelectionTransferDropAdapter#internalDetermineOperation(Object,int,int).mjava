	private int internalDetermineOperation(Object target, int operation, int operations) {

		initializeSelection();

		if (target == null)
			return DND.DROP_NONE;

		IResource[] resources = getResources(fElements);
		// Do not allow to drop on itself, bug 14228
		if (getCurrentLocation() == LOCATION_ON) {
			IModelElement[] javaElements = ReorgUtils.getModelElements(fElements);
			if (contains(javaElements, target))
				return DND.DROP_NONE;

			if (contains(resources, target))
				return DND.DROP_NONE;
		}

		if (target instanceof IModelElement) {
			IResource targetResource = ReorgUtils.getResource((IModelElement) target);
			if ((targetResource instanceof IContainer) && isParentOfAny((IContainer) targetResource, resources)) {
				return DND.DROP_NONE;
			}

		}

		try {
			switch (operation) {
			case DND.DROP_DEFAULT:
				return handleValidateDefault(target, operations);
			case DND.DROP_COPY:
				return handleValidateCopy(target);
			case DND.DROP_MOVE:
				return handleValidateMove(target);
			}
		} catch (ModelException e) {
			ExceptionHandler.handle(e, ScriptMessages.SelectionTransferDropAdapter_error_title,
					ScriptMessages.SelectionTransferDropAdapter_error_message);
		}

		return DND.DROP_NONE;
	}

