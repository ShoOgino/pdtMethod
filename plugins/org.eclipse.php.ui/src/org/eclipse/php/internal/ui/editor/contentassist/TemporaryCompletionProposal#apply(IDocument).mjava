	/** (non-Javadoc)
	 * @see org.eclipse.jface.text.contentassist.ICompletionProposal#apply(org.eclipse.jface.text.IDocument)
	 */
	public void apply(IDocument document) {
		final IWorkbenchPage page = PHPUiPlugin.getActivePage();
		final StructuredTextViewer textViewer;
		if (page != null) {
			final IEditorPart editor = page.getActiveEditor();
			if (editor instanceof PHPStructuredEditor) {
				textViewer = ((PHPStructuredEditor) editor).getTextViewer();
			} else {
				textViewer = null;
			}
		} else {
			textViewer = null;
		}
		if (textViewer != null && textViewer.getDocument() == document) {
			textViewer.addSelectionChangedListener(new ISelectionChangedListener() {
				public void selectionChanged(SelectionChangedEvent event) {
					textViewer.removeSelectionChangedListener(this);
					final long delay = PreferenceConstants.getPreferenceStore().getInt(PreferenceConstants.CODEASSIST_AUTOACTIVATION_DELAY);
					new Timer("Temporary Completion delay").schedule(new TimerTask() {
						@Override
						public void run() {
							textViewer.getControl().getDisplay().asyncExec(new Runnable() {
								public void run() {
									BusyIndicator.showWhile(textViewer.getControl().getDisplay(), new Runnable() {
										public void run() {
											textViewer.doOperation(ISourceViewer.CONTENTASSIST_PROPOSALS);
										}
									});
								}
							});
						}
					}, delay);
				}
			});
		}
		proposal.apply(document);
	}

