	/**
	 * Set the indent of a bracket based on the command provided in the supplied
	 * document.
	 * 
	 * @param document
	 *            - the document being parsed
	 * @param command
	 *            - the command being performed
	 */
	protected void smartPaste(IDocument document, DocumentCommand command) {
		if (command.offset == -1 || document.getLength() == 0)
			return;
		try {
			if (document instanceof IStructuredDocument) {
				IStructuredDocument structuredDocument = (IStructuredDocument) document;
				IRegion region = document.getLineInformation(document
						.getLineOfOffset(command.offset));
				if (document.get(region.getOffset(), region.getLength()).trim()
						.length() == 0) {// blank line
				// if (command.offset != region.getOffset()) {
					document.replace(region.getOffset(), region.getLength(), "");
					// adjust the offset
					command.offset = region.getOffset();
					// }
					String oldContent = document.get();
					int endHalf = oldContent.length() - region.getOffset();
					document.replace(region.getOffset(), 0, command.text);
					PhpFormatter formatter = new PhpFormatter(
							region.getOffset(), command.text.length());

					formatter
							.format(structuredDocument
									.getStructuredDocumentRegions(
											region.getOffset(), 0)[0]);
					String newContent = document.get();
					command.text = newContent.substring(region.getOffset(),
							newContent.length() - endHalf);
					document.set(oldContent);
					return;

				} else {
					return;
				}
			}
		} catch (BadLocationException e) {
		}
	}

