	/*
	 * @see ViewerSorter#compare
	 */
	public int compare(Viewer viewer, Object e1, Object e2) {

		int cat1 = category(e1);
		int cat2 = category(e2);

		if (usingCategories) {
			if (cat1 != cat2)
				return cat1 - cat2;
		}

		// if we are dealing with dom nodes then the shouldn't be any sort at all (wst outline viewer doesn't have any sorter).
		if(cat1 == DOM_NODES){
			return -1;
		}
		if (cat1 == PROJECTS || cat1 == RESOURCES || cat1 == RESOURCEFOLDERS || cat1 == STORAGE || cat1 == OTHERS) {
			String name1 = getNonPHPElementLabel(viewer, e1);
			String name2 = getNonPHPElementLabel(viewer, e2);
			if (name1 == name2)
				return 0;
			if (name1 != null) {
				return getCollator().compare(name1, name2);
			}
			return -1; // can't compare
		}

		// if it is an outline node (classes, functions, constants) sort by type
		if (cat1 == OUTLINE_NODES && cat2 == OUTLINE_NODES) {
			return ((Comparable) e1).compareTo(e2);
		}

		int vis = 0;
		if (e1 instanceof PHPCodeData) {
			if (fMemberOrderCache.isSortByVisibility()) {
				int flags1 = getVisibilityCode(e1);
				int flags2 = getVisibilityCode(e2);
				vis = fMemberOrderCache.getVisibilityIndex(flags1) - fMemberOrderCache.getVisibilityIndex(flags2);
				if (usingCategories) {
					if (vis != 0) {
						return vis;
					}
				}
			}
		}

		boolean currentUsingLocation = false;

		UserData userData1 = null;
		UserData userData2 = null;

		if (usingLocation && e1 instanceof PHPCodeData && e2 instanceof PHPCodeData) {
			currentUsingLocation = true;
			PHPCodeData code1 = (PHPCodeData) e1;
			PHPCodeData code2 = (PHPCodeData) e2;
			if (PHPModelUtil.getPHPFileContainer(code1) != PHPModelUtil.getPHPFileContainer(code2)) {
				currentUsingLocation = false;
			} else {
				userData1 = code1.getUserData();
				userData2 = code2.getUserData();

				if (userData1 == null || userData2 == null)
					currentUsingLocation = false;
			}
		}
		if (currentUsingLocation) {
			return userData1.getStartPosition() - userData2.getStartPosition();
		}
		if (e1 instanceof PHPSuperClassNameData) {
			if (!(e1 instanceof PHPSuperClassNameData)) {
				return -1;
			}
		} else if (e2 instanceof PHPSuperClassNameData) {
			return +1;
		}

		String name1 = getElementName(e1);
		String name2 = getElementName(e2);

		int cmp = getCollator().compare(name1, name2);
		if (cmp != 0) {
			return cmp;
		}

		// from here names are equal:

		if (e1 instanceof PHPFunctionData && e2 instanceof PHPFunctionData) {
			PHPFunctionParameter[] params1 = ((PHPFunctionData) e1).getParameters();
			PHPFunctionParameter[] params2 = ((PHPFunctionData) e2).getParameters();
			int len = Math.min(params1.length, params2.length);
			for (int i = 0; i < len; i++) {
				String classType1 = params1[i].getClassType();
				String classType2 = params2[i].getClassType();
				if (classType1 == null) {
					if (classType2 == null)
						return 0;
					return 1;
				} else if (classType2 == null)
					return -1;
			}
			return params1.length - params2.length;
		}
		if (!usingCategories) { // process categories after names, if not categorized:
			if (cat1 != cat2)
				return cat1 - cat2;
			return vis;
		}
		return 0;
	}

