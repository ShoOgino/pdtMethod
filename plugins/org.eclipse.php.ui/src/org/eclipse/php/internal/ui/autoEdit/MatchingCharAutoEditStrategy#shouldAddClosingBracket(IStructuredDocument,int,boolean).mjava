	/**
	 * returns true if the offset in the document is not to the left of text
	 * excluding php closing tag (?>) and comments  
	 */
	protected boolean shouldAddClosingBracket(final IStructuredDocument document, final int offset, final boolean isQuote) throws BadLocationException {
		if (document.getLength() == offset)
			return true;

		final char currChar = document.getChar(offset);
		if (Character.isWhitespace(currChar) || isClosingBracket(currChar) || isQuote && isQuote(currChar) || currChar == ';')
			return true;
		if (offset + 1 >= document.getLength())
			return false;
		final char nextChar = document.getChar(offset + 1);
		final String state = FormatterUtils.getPartitionType(document, offset);

		if (state == PHPPartitionTypes.PHP_DEFAULT || state == PHPRegionTypes.PHP_OPENTAG || state == PHPRegionTypes.PHP_CLOSETAG)
			// should work everywhere:
			return true;
		/*			if (currChar == '?' && nextChar == '>') {
		 return true;
		 }
		 if (currChar == '<' && nextChar == '<') { // checking for heredoc
		 //				return true;
		 int position = offset + 2;
		 while (position < document.getLength()) {
		 char c = document.getChar(position);
		 if (Character.isWhitespace(c)) {
		 if (position + 1 == document.getLength()) { // if its the end of the text then its ok
		 return true;
		 }
		 //                        TO_DO add support in heredoc state
		 //                        String state1 = FormatterUtils.getPartitionType(document, position + 1);
		 //                        if (state1 == PhpLexer.ST_PHP_HEREDOC) {
		 //                            return true;
		 //                        }
		 break;
		 }
		 position++;
		 }
		 }
		 */

		if (currChar == '/' && (nextChar == '/' || nextChar == '*'))
			return true;
		return false;
	}

