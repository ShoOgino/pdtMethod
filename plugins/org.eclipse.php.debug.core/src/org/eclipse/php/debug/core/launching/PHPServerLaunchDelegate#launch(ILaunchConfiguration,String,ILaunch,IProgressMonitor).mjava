	public void launch(ILaunchConfiguration configuration, String mode, ILaunch launch, IProgressMonitor monitor) throws CoreException
	{
		boolean runWithDebug = configuration.getAttribute("run_with_debug", true);
		
		if(mode.equals(ILaunchManager.RUN_MODE)&& !runWithDebug)
		{
			httpServerDelegate.doLaunch(configuration,mode,launch,monitor);
			return;
		}
		
		IServer server = ServerUtil.getServer(configuration);
		if (server == null) {
			Logger.log(Logger.ERROR, "Luanch configuration could not find server");
			// throw CoreException();
			return;
		}

		ApacheServerBehaviour apacheServerBehaviour = (ApacheServerBehaviour) server.loadAdapter(ApacheServerBehaviour.class, null);
		apacheServerBehaviour.setupLaunch(launch, mode, monitor);
		
		IModuleArtifact moduleArtifact = httpServerDelegate.getModuleArtifact(configuration);
		if(moduleArtifact == null)
			throw new CoreException(new Status(IStatus.ERROR, PHPDebugPlugin.getID(), IPHPConstants.INTERNAL_ERROR, PHPDebugCoreMessages.configurationError,null));
		
		IModule module = moduleArtifact.getModule();
		
		boolean publish = configuration.getAttribute(ApachePlugin.DEPLOYABLE, false);
		if(publish)
			apacheServerBehaviour.publish(module,monitor);
		
		ILaunchConfigurationWorkingCopy wc = configuration.getWorkingCopy();
		IProject proj = module.getProject();
		String project = proj.getFullPath().toString();
		
		wc.setAttribute(IPHPConstants.PHP_Project, project);
		wc.doSave();
		
		String URL = configuration.getAttribute(ApachePlugin.URL, "");
		String contextRoot = configuration.getAttribute(ApachePlugin.CONTEXT_ROOT, "");
		
		PHPDebugTarget target = null;
		if (mode.equals(ILaunchManager.DEBUG_MODE) || runWithDebug == true) {
            if (mode.equals(ILaunchManager.DEBUG_MODE))runWithDebug = false;
            boolean stopAtFirstLine = PHPProjectPreferences.getStopAtFirstLine(proj);
            int requestPort = PHPProjectPreferences.getDebugPort(proj);   
			PHPProcess process = new PHPProcess(launch, URL);
			apacheServerBehaviour.setProcess(process);
			target = new PHPDebugTarget(launch, URL, requestPort, process, contextRoot, runWithDebug, stopAtFirstLine, proj);
			launch.addDebugTarget(target);
		}
	}

