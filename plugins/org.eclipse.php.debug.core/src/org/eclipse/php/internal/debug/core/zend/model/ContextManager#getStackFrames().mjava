	public IStackFrame[] getStackFrames() throws DebugException {

		// check to see if eclipse is getting the same stack frames again.
		PHPstack stack = fDebugger.getCallStack();
		StackLayer[] layers = stack.getLayers();

		PHPThread thread = (PHPThread) fTarget.getThreads()[0];

		fFramesInitLock.acquire();
		try {
			if (fFrames == null) {
				IStackFrame[] newFrames = applyDebugFilters(createNewFrames(
						layers, thread));
				copyVariablesFromPreviousFrames(newFrames);
				fFrames = newFrames;

				DefaultExpressionsManager expressionsManager = fTarget
						.getExpressionManager();
				if (expressionsManager != null) {
					expressionsManager.clear();
				}
				fSuspendCount = fTarget.getSuspendCount();
				return fFrames;
			}
		} finally {
			fFramesInitLock.release();
		}

		if (fSuspendCount == fTarget.getSuspendCount()) {
			return fFrames;
		}

		if (layers.length == 1
				&& layers[0].getCalledFileName().endsWith(DUMMY_PHP_FILE)) {
			fDebugger.finish();// reached dummy file --> finish debug !
		} else {
			IStackFrame[] newFrames = applyDebugFilters(createNewFrames(layers,
					thread));
			copyVariablesFromPreviousFrames(newFrames);
			fFrames = newFrames;
		}

		fSuspendCount = fTarget.getSuspendCount();

		return fFrames;
	}

