	protected static String findServiceClassName(final String serviceId, final String defaultService) throws IllegalArgumentException {
		if (defaultService == null)
			throw new IllegalArgumentException("Provider for " + serviceId + " cannot be found"); //$NON-NLS-1$ //$NON-NLS-2$

		final ClassLoader classLoader = Thread.currentThread().getContextClassLoader();
		String serviceClassName = null;

		// Use the system property first
		try {
			final String systemProp = System.getProperty(serviceId);

			if (systemProp != null)
				serviceClassName = systemProp;
		} catch (final SecurityException x) {
			;
		}

		if (serviceClassName == null) {
			final String servicePath = "META-INF/services/" + serviceId; //$NON-NLS-1$

			// try to find services in CLASSPATH
			try {
				InputStream is = null;

				if (classLoader == null)
					is = ClassLoader.getSystemResourceAsStream(servicePath);
				else
					is = classLoader.getResourceAsStream(servicePath);

				if (is != null) {
					final BufferedReader rd = new BufferedReader(new InputStreamReader(is, "UTF-8")); //$NON-NLS-1$

					String line = rd.readLine();
					rd.close();

					if (line != null && !"".equals(line = line.trim())) //$NON-NLS-1$
						serviceClassName = line.split("\\s|#")[0]; //$NON-NLS-1$
				}
			} catch (final Exception x) {
				;
			}
		}

		if (serviceClassName == null)
			serviceClassName = defaultService;

		return serviceClassName;
	}

