	/**
	 * Service oszt�ly nev�nek keres�se
	 *
	 * a JDK JAR specifik�ci�ban defini�lt <B>Services API</B>-nak
	 * megfelel�en service oszt�ly keres�s.</p><p>
	 * Az implement�l� oszt�ly n�v keres�se a <CODE>serviceId</CODE> nev�
	 * system property vizsg�lat�val kezd�dik. Amennyiben nincs ilyen
	 * property, �gy a keres�s a
	 * <CODE>/META-INF/services/<I>serviceId</I></CODE> nev� file tartalm�val
	 * folytat�dik. Amennyiben nincs ilyen nev� file, �gy a param�terk�nt �tadott
	 * <CODE>defaultService</CODE> lesz az oszt�ly neve.</p><p>
	 * @param serviceId keresett oszt�ly/service neve
	 * @param defaultService alap�rtelmezett implement�l� oszt�ly neve
	 * @throws IllegalArgumentException keres�si vagy p�ld�nyos�t�si hiba eset�n
	 * @return a keresett oszt�ly neve
	 */
	protected static String findServiceClassName(final String serviceId, final String defaultService) throws IllegalArgumentException {
		if (defaultService == null)
			throw new IllegalArgumentException("Provider for " + serviceId + " cannot be found"); //$NON-NLS-1$ //$NON-NLS-2$

		final ClassLoader classLoader = Thread.currentThread().getContextClassLoader();
		String serviceClassName = null;

		// Use the system property first
		try {
			final String systemProp = System.getProperty(serviceId);

			if (systemProp != null)
				serviceClassName = systemProp;
		} catch (final SecurityException x) {
			;
		}

		if (serviceClassName == null) {
			final String servicePath = "META-INF/services/" + serviceId; //$NON-NLS-1$

			// try to find services in CLASSPATH
			try {
				InputStream is = null;

				if (classLoader == null)
					is = ClassLoader.getSystemResourceAsStream(servicePath);
				else
					is = classLoader.getResourceAsStream(servicePath);

				if (is != null) {
					final BufferedReader rd = new BufferedReader(new InputStreamReader(is, "UTF-8")); //$NON-NLS-1$

					String line = rd.readLine();
					rd.close();

					if (line != null && !"".equals(line = line.trim())) //$NON-NLS-1$
						serviceClassName = line.split("\\s|#")[0]; //$NON-NLS-1$
				}
			} catch (final Exception x) {
				;
			}
		}

		if (serviceClassName == null)
			serviceClassName = defaultService;

		return serviceClassName;
	}

