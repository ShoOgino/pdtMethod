	/**
	 * Determines the return type of the given method element.
	 * @param method
	 * @param mask
	 * @param offset
	 * @return
	 */
	public static IType[] getFunctionReturnType(IMethod method, int mask, int offset) {
		PHPTypeInferencer typeInferencer = new PHPTypeInferencer();

		org.eclipse.dltk.core.ISourceModule sourceModule = method.getSourceModule();
		ModuleDeclaration moduleDeclaration = SourceParserUtil.getModuleDeclaration(sourceModule, null);
		FileContext fileContext = new FileContext(sourceModule, moduleDeclaration, offset);

		IType currentType = PHPModelUtils.getCurrentType(sourceModule, offset);
		TypeContext instanceContext = new TypeContext(fileContext, currentType == null ? null : new PHPClassType(currentType.getElementName()));
		
		IEvaluatedType evaluatedType;
		IModelElement[] modelElements;
		boolean usePhpDoc = (mask & USE_PHPDOC) != 0;
		if (usePhpDoc) {
			PHPDocMethodReturnTypeGoal phpDocGoal = new PHPDocMethodReturnTypeGoal(instanceContext, method.getElementName());
			evaluatedType = typeInferencer.evaluateTypePHPDoc(phpDocGoal, 3000);

			modelElements = PHPTypeInferenceUtils.getModelElements(evaluatedType, fileContext, offset);
			if (modelElements != null) {
				return modelElementsToTypes(modelElements);
			}
		}

		MethodElementReturnTypeGoal methodGoal = new MethodElementReturnTypeGoal(instanceContext, method);
		evaluatedType = typeInferencer.evaluateType(methodGoal);
		modelElements = PHPTypeInferenceUtils.getModelElements(evaluatedType, fileContext, offset);
		if (modelElements != null) {
			return modelElementsToTypes(modelElements);
		}
		return EMPTY_TYPES;
	}

