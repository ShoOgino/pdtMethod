	/**
	 * This method searches in the project scope for all elements of specified type that match the given prefix.
	 * If currentFileOnly parameter is <code>true</code>, the search scope for variables will contain only the source module.
	 * If the project doesn't exist, workspace scope is used.
	 * 
	 * @param sourceModule Current source module
	 * @param prefix Element name or prefix
	 * @param exactName Whether the prefix is an exact name of the element
	 * @param elementType Element type from {@link IDLTKSearchConstants}
	 * @param currentFileOnly Whether to search elements in current file only
	 * @return
	 */
	private static IModelElement[] getGlobalElements(ISourceModule sourceModule, String prefix, boolean exactName, int elementType, boolean currentFileOnly, boolean caseSensitive) {

		IDLTKLanguageToolkit toolkit = PHPLanguageToolkit.getDefault();

		boolean isVariable = prefix.startsWith("$"); //$NON-NLS-1$

		IScriptProject scriptProject = sourceModule.getScriptProject();
		if (!ScriptProject.hasScriptNature(scriptProject.getProject())) {
			List<IModelElement> elements = new LinkedList<IModelElement>();
			try {
				switch (elementType) {
					case IDLTKSearchConstants.TYPE:
						IType[] types = sourceModule.getTypes();
						for (IType type : types) {
							String typeName = type.getElementName();
							if (exactName) {
								if (typeName.equalsIgnoreCase(prefix)) {
									elements.add(type);
								}
							} else if (startsWithIgnoreCase(typeName, prefix)) {
								elements.add(type);
							}
						}
						break;
					case IDLTKSearchConstants.METHOD:
						IMethod[] methods = ((AbstractSourceModule)sourceModule).getMethods();
						for (IMethod method : methods) {
							String methodName = method.getElementName();
							if (exactName) {
								if (methodName.equalsIgnoreCase(prefix)) {
									elements.add(method);
								}
							} else if (startsWithIgnoreCase(methodName, prefix)) {
								elements.add(method);
							}
						}
						break;
					case IDLTKSearchConstants.FIELD:
						IField[] fields = sourceModule.getFields();
						for (IField field : fields) {
							String fieldName = field.getElementName();
							if (exactName) {
								if (fieldName.equals(prefix)) {
									elements.add(field);
								}
							} else if (fieldName.startsWith(prefix)) {
								elements.add(field);
							}
						}
						break;
				}
			} catch (ModelException e) {
				if (DLTKCore.DEBUG_COMPLETION) {
					e.printStackTrace();
				}
			}
			return elements.toArray(new IModelElement[elements.size()]);
		}

		IDLTKSearchScope scope;
		if (currentFileOnly) {
			scope = SearchEngine.createSearchScope(sourceModule);
		} else {
			if (scriptProject != null) {
				scope = SearchEngine.createSearchScope(scriptProject);
			} else {
				scope = SearchEngine.createWorkspaceScope(toolkit);
			}
		}

		if (!currentFileOnly && isVariable) {
			// search variables using mixin model:
			PHPMixinModel mixinModel = scriptProject == null ? PHPMixinModel.getWorkspaceInstance() : PHPMixinModel.getInstance(scriptProject);
			IModelElement[] variables = mixinModel.getVariable(prefix + WILDCARD, null, null, scope);
			return variables == null ? EMPTY : filterOtherFilesElements(sourceModule, variables);
		}

		return getGlobalElements(sourceModule, scope, prefix, exactName, elementType, currentFileOnly, caseSensitive);
	}

