	private static void internalBuildReferencingFilesTree(Node root,
			Set<ISourceModule> processedFiles, IProgressMonitor monitor) {

		if (monitor != null && monitor.isCanceled()) {
			return;
		}

		ISourceModule file = root.getFile();

		IDLTKSearchScope scope;
		if (file instanceof ExternalSourceModule) {
			scope = SearchEngine.createWorkspaceScope(DLTKLanguageManager
					.getLanguageToolkit(file));
		} else {
			scope = SearchEngine.createSearchScope(file.getScriptProject());
		}

		IField[] includes = PhpModelAccess.getDefault().findIncludes(
				file.getPath().lastSegment(), MatchRule.EXACT, scope);
		for (IField include : includes) {
			if (monitor != null && monitor.isCanceled()) {
				return;
			}

			// Candidate that includes the original source module:
			ISourceModule referencingFile = include.getSourceModule();

			// Try to resolve include:
			ISourceModule testFile = findSourceModule(referencingFile,
					((IncludeField) include).getFilePath());

			// If this is the correct include (that means that included file is
			// the original file):
			if (file.equals(testFile)
					&& !processedFiles.contains(referencingFile)) {
				processedFiles.add(referencingFile);
				Node node = new Node(referencingFile);
				root.addChild(node);
			}
		}

		Collection<Node> children = root.getChildren();
		if (children != null) {
			for (Node child : children) {
				internalBuildReferencingFilesTree(child, processedFiles,
						monitor);
			}
		}
	}

