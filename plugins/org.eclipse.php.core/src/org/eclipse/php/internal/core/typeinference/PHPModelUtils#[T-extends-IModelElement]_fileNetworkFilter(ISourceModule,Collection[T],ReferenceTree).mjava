	/**
	 * Filters model elements using file network.
	 * 
	 * @param sourceModule
	 *            Source module
	 * @param elements
	 *            Model elements to filter
	 * @param referenceTree
	 *            Cached instance of file hierarchy
	 * @return
	 */
	public static <T extends IModelElement> Collection<T> fileNetworkFilter(
			ISourceModule sourceModule, Collection<T> elements,
			ReferenceTree referenceTree) {

		if (elements != null && elements.size() > 0) {
			List<T> filteredElements = new LinkedList<T>();

			// If some of elements belong to current file return just it:
			for (T element : elements) {
				if (sourceModule.equals(element.getOpenable())) {
					filteredElements.add(element);
				}
			}
			if (filteredElements.size() == 0) {
				// Filter by includes network
				if (referenceTree == null) {
					referenceTree = FileNetworkUtility
							.buildReferencedFilesTree(sourceModule, null);
				}
				for (T element : elements) {
					if (LanguageModelInitializer
							.isLanguageModelElement(element)
							|| referenceTree.find(((ModelElement) element)
									.getSourceModule())) {
						filteredElements.add(element);
					}
				}
			}
			if (filteredElements.size() > 0) {
				elements = filteredElements;
			}
		}
		return elements;
	}

