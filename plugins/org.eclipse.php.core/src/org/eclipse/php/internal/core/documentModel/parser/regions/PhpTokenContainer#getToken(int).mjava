	/**
	 * find token for a given location 
	 * @param offset
	 * @return
	 * @throws BadLocationException - if the offset is out of bound 
	 */
	public ITextRegion getToken(int offset) throws BadLocationException {
		assert tokensIterator != null;
		if (phpTokens.isEmpty()) {
			return null;
		}

		//we have at least one region...		
		checkBadLocation(offset);

		// smart searching
		ITextRegion result = (ITextRegion) (tokensIterator.hasNext() ? tokensIterator.next() : tokensIterator.previous());
		if (isInside(result, offset)) {
			return result;
		}

		if (offset >= result.getEnd()) { // if the offset is beyond - go fetch from next
			while (tokensIterator.hasNext() && !isInside(result, offset)) {
				result = (ITextRegion) tokensIterator.next();
			}
		} else { // else go fetch from previous
			while (tokensIterator.hasPrevious() && !isInside(result, offset)) {
				result = (ITextRegion) tokensIterator.previous();
			}
			// moves the iterator to the next one
			if (tokensIterator.hasNext()) {
				tokensIterator.next();
			}
		}

		return result;
	}

