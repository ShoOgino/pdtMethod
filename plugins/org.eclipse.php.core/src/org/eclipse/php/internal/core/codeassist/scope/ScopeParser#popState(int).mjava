	private void popState(int end) {
		State state = states.pop();
		state.length = end - state.start;
		if (state.start <= internalOffset && end >= internalOffset) {
			memory.addFirst(state);
		}
		if (states.peek() instanceof SimpleBlockState) {
			popState(end);
			popState(end);
		}
	}

