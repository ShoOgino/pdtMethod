	public static void updateProjectReferences(IIncludePathEntry[] newEntries, IIncludePathEntry[] oldEntries, final IProject project, SubProgressMonitor monitor) {
		try {
			boolean changedReferences = false;
			if (!project.isAccessible()) {
				return;
			}
			final IProjectDescription projectDescription = project.getDescription();
			List<IProject> referenced = new ArrayList<IProject>();
			List<String> referencedNames = new ArrayList<String>();
			IProject[] referencedProjects = projectDescription.getReferencedProjects();
			for (IProject element : referencedProjects) {
				referenced.add(element);
				referencedNames.add(element.getName());
			}

			for (IIncludePathEntry element : oldEntries) {
				if (element.getEntryKind() == IIncludePathEntry.IPE_PROJECT) {
					String projectName = element.getPath().segment(0);
					if (projectName.equals(project.getName())) {
						continue;
					}
					if (!containsProject(newEntries, projectName)) {
						if (((IncludePathEntry) element).createdReference) {
							int index = referencedNames.indexOf(projectName);
							if (index >= 0) {
								changedReferences = true;
								referencedNames.remove(index);
								referenced.remove(index);
							}
						}
					}
				}
			}

			for (int i = 0; i < newEntries.length; i++) {
				if (newEntries[i].getEntryKind() == IIncludePathEntry.IPE_PROJECT) {
					String projectName = newEntries[i].getPath().segment(0);
					if (projectName.equals(project.getName())) {
						continue;
					}
					if (!containsProject(oldEntries, projectName)) {
						if (!referencedNames.contains(projectName)) {
							changedReferences = true;
							((IncludePathEntry) newEntries[i]).createdReference = true;
							referenced.add(ResourcesPlugin.getWorkspace().getRoot().getProject(projectName));
							referencedNames.add(projectName);
						}
					}
				}
			}
			if (changedReferences) {
				IProject[] referenceProjects = referenced.toArray(new IProject[referenced.size()]);
				projectDescription.setReferencedProjects(referenceProjects);
				WorkspaceJob job = new WorkspaceJob(CoreMessages.getString("IncludePathEntry_2")) {
					public IStatus runInWorkspace(IProgressMonitor monitor) throws CoreException {
						project.setDescription(projectDescription, monitor);
						return Status.OK_STATUS;
					}
				};
				job.setRule(project.getParent());
				job.schedule();
			}
		} catch (CoreException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}

