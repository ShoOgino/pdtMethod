	protected boolean isInFunctionDeclaration(TextSequence text, int offset) {
		// are we inside function declaration statement
		int functionStart = PHPTextSequenceUtilities.isInFunctionDeclaration(text);
		if (functionStart == -1) {
			return false;
		}

		// are we inside parameters part in function declaration statement
		for (int i = text.length() - 1; i >= functionStart; i--) {
			if (text.charAt(i) == '(') {
				boolean showClassCompletion = true;
				boolean showInitializerCompletion = false;
				int j = text.length() - 1;
				for (; j > i; j--) {
					// fixed bug 178032 - check if the cursor is after type means no '$' sign between cursor to '(' sign or ',' sign
					if (text.charAt(j) == '$') {
						showClassCompletion = false;
						break;
					}
					if (text.charAt(j) == '=') {
						showInitializerCompletion = true;
						showClassCompletion = false;
						break;
					}
					if (text.charAt(j) == ',') {
						break;
					}
				}
				if (showClassCompletion) {
					String prefix = text.subTextSequence(j + 1, text.length()).toString();
					//remove leading white spaces
					int k = 0;
					for (; k < prefix.length(); k++) {
						if (!Character.isWhitespace(prefix.charAt(k))) {
							break;
						}
					}
					if (k != 0) {
						prefix = prefix.substring(k);
					}

					this.setSourceRange(offset - prefix.length(), offset);

					int relevanceClass = RELEVANCE_CLASS;
					int mask = 0;
					if (requestor.isContextInformationMode()) {
						mask |= CodeAssistUtils.EXACT_NAME;
					}
					IType[] classes = CodeAssistUtils.getGlobalTypes(sourceModule, prefix, mask);
					for (IType type : classes) {
						try {
							if (!PHPFlags.isInternal(type.getFlags())) {
								reportType(type, relevanceClass--, WHITESPACE_SUFFIX);
							}
						} catch (ModelException e) {
							if (DLTKCore.DEBUG_COMPLETION) {
								e.printStackTrace();
							}
						}
					}
				} else {
					if (showInitializerCompletion) {
						String prefix = text.subTextSequence(j + 1, text.length()).toString().trim();

						if (showConstantAssist()) {

							this.setSourceRange(offset - prefix.length(), offset);

							int mask = 0;
							if (requestor.isContextInformationMode()) {
								mask |= CodeAssistUtils.EXACT_NAME;
							}
							if (!showVarsFromOtherFiles()) {
								mask |= CodeAssistUtils.ONLY_CURRENT_FILE;
							}
							if (constantsCaseSensitive()) {
								mask |= CodeAssistUtils.CASE_SENSITIVE;
							}
							IModelElement[] constants = CodeAssistUtils.getGlobalFields(sourceModule, prefix, mask);
							int relevanceConst = RELEVANCE_CONST;
							for (IModelElement constant : constants) {
								IField field = (IField) constant;
								try {
									if ((field.getFlags() & Modifiers.AccConstant) != 0) {
										reportField(field, relevanceConst--, false);
									}
								} catch (ModelException e) {
									if (DLTKCore.DEBUG_COMPLETION) {
										e.printStackTrace();
									}
								}
							}
						}
					}
				}
				return true;
			}
		}

		IType classData = CodeAssistUtils.getContainerClassData(sourceModule, text.getOriginalOffset(functionStart));
		// We look for the container class data in function start offset.

		if (classData == null) {
			// We are not inside class function.
			return true;
		}

		int wordEnd = PHPTextSequenceUtilities.readBackwardSpaces(text, text.length());
		int wordStart = PHPTextSequenceUtilities.readIdentifierStartIndex(text, wordEnd, false);
		String word = text.subSequence(wordStart, wordEnd).toString();

		String functionNameStart;
		if (word.equals(FUNCTION)) { //$NON-NLS-1$
			functionNameStart = EMPTY;
		} else if (wordEnd == text.length()) {
			functionNameStart = word;
		} else {
			return true;
		}

		this.setSourceRange(offset - functionNameStart.length(), offset);

		int relevanceMethod = RELEVANCE_METHOD;

		int mask = 0;
		if (requestor.isContextInformationMode()) {
			mask |= CodeAssistUtils.EXACT_NAME;
		}
		IMethod[] superClassMethods = CodeAssistUtils.getSuperClassMethods(classData, functionNameStart, mask);
		for (IMethod superMethod : superClassMethods) {
			if (classData.getMethod(superMethod.getElementName()).exists()) {
				continue;
			}
			try {
				int flags = superMethod.getFlags();
				if (!PHPFlags.isFinal(flags) && !PHPFlags.isPrivate(flags) && !PHPFlags.isStatic(flags) && !PHPFlags.isInternal(flags)) {
					reportMethod(superMethod, relevanceMethod--);
				}
			} catch (ModelException e) {
				if (DLTKCore.DEBUG_COMPLETION) {
					e.printStackTrace();
				}
			}
		}

		List<String> functions = new LinkedList<String>();
		functions.addAll(Arrays.asList(magicFunctions));
		if (isPHP5) {
			functions.addAll(Arrays.asList(magicFunctionsPhp5));
		}
		functions.add(classData.getElementName());
		if (isPHP5) {
			functions.add(CONSTRUCTOR);
			functions.add(DESTRUCTOR);
		}

		for (String function : functions) {
			if (CodeAssistUtils.startsWithIgnoreCase(function, functionNameStart)) {
				if (!requestor.isContextInformationMode() || function.length() == functionNameStart.length()) {
					FakeMethod fakeMagicMethod = new FakeMethod((ModelElement) classData, function);
					reportMethod(fakeMagicMethod, relevanceMethod--);
				}
			}
		}
		return true;
	}

