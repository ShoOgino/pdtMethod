	public ITypedRegion getPartition(final int offset, final boolean preferOpenPartitions) {
		ITypedRegion region = getPartition(offset);
		ITypedRegion newRegion;
		if ((isPHPPartitionType(region.getType()) || offset == fStructuredDocument.getLength()) && preferOpenPartitions) {
			if (region.getOffset() == offset)
				if (offset > 0) {
					IRegion lineInfo = null;
					try {
						lineInfo = fStructuredDocument.getLineInformationOfOffset(offset);
					} catch (BadLocationException e) {
					}
					if (lineInfo == null || lineInfo.getOffset() != offset || offset == fStructuredDocument.getLength()) {
						newRegion = getPartition(offset - 1);
						final String newRegionType = newRegion.getType();
						if (newRegionType != PHPPartitionTypes.PHP_MULTI_LINE_COMMENT && newRegionType != PHPPartitionTypes.PHP_QUOTED_STRING && newRegionType != PHPPartitionTypes.PHP_DOC)
							region = newRegion;
					}
				}
		}
		return region;
	}

