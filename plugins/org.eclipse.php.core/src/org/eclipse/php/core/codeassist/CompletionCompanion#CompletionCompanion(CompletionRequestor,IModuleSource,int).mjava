	public CompletionCompanion(CompletionRequestor requestor, IModuleSource moduleSource, int offset) {
		this.offset = offset;
		this.sourceModule = (ISourceModule) moduleSource.getModelElement();
		this.phpVersion = ProjectOptions.getPHPVersion(getSourceModule().getScriptProject().getProject());
		try {
			this.document = determineDocument(sourceModule, requestor);
			if (this.document != null) {

				structuredDocumentRegion = determineStructuredDocumentRegion(document, offset);
				if (structuredDocumentRegion != null) {

					regionCollection = determineRegionCollection(document, structuredDocumentRegion, offset);
					if (regionCollection != null) {

						phpScriptRegion = determinePHPRegion(document, regionCollection, offset);
						if (phpScriptRegion != null) {

							partitionType = determinePartitionType(regionCollection, phpScriptRegion, offset);
							if (partitionType != null) {
								determineNamespace();
							}

						}
					}
				}
			}
		} catch (ResourceAlreadyExists | IOException | CoreException | BadLocationException e) {
			Logger.logException(e);
		}

	}

