	public static String getPartitionType(IStructuredDocument document, int offset) {
		final IStructuredDocumentRegion sdRegion = document.getRegionAtCharacterOffset(offset);
		final ITextRegion tRegion = sdRegion.getRegionAtCharacterOffset(offset);
		if (tRegion == null) {
			return null;
		}
		String result = null;

		final String type = tRegion.getType();
		if (tRegion instanceof PHPContentRegion) {
			if (PhpLexer.isPHPMultiLineCommentState(type)) {
				result = PHPPartitionTypes.PHP_MULTI_LINE_COMMENT; 
			} else if (PhpLexer.isPHPLineCommentState(type)) {
				result = PHPPartitionTypes.PHP_SINGLE_LINE_COMMENT ; 
			} else if (PhpLexer.isPHPDocState(type)) {
				result = PHPPartitionTypes.PHP_DOC; 
			} else if (PhpLexer.isPHPQuotesState(type)) {
				result = checkBounds(sdRegion, tRegion, offset, PHPPartitionTypes.PHP_QUOTED_STRING);
			} else if (PHPRegionTypes.TASK == type) {
				// return the previous region type
				if (sdRegion.getPrevious() == null) {
					return null;
				}
				result = getPartitionType(document, sdRegion.getStartOffset() + tRegion.getStart() - 1);
			} else {
				result = PHPPartitionTypes.PHP_DEFAULT;
			}
		} else if (type == PHPRegionTypes.PHP_OPENTAG) {
			result = offset >= sdRegion.getStartOffset() + tRegion.getTextEnd() ? PHPPartitionTypes.PHP_DEFAULT : PHPRegionTypes.PHP_OPENTAG;  
		} else if (type == PHPRegionTypes.PHP_CLOSETAG) {
			result = offset == sdRegion.getStartOffset() + tRegion.getStart() ? PHPPartitionTypes.PHP_DEFAULT :  PHPRegionTypes.PHP_CLOSETAG;
		}
		return result;
	}

