	/**
	 * Internal method for parsing a .pdtt test file
	 * @param inputStream
	 * @throws Exception 
	 */
	protected void parse(InputStream inputStream) throws Exception {
		BufferedReader bReader = new BufferedReader(new InputStreamReader(inputStream));

		String line = bReader.readLine();
		STATES state = null;
		while (line != null) {
			if (line.matches("--[A-Z]+--")) {
				state = parseStateLine(line);
				if (state == null) {
					throw new Exception("Wrong state: " + line);
				}
			} else {
				if (state != null) {
					onState(state, line);
				}
			}
			line = bReader.readLine();
		}
	}

