	public static Test suite() {

		TestSuite suite = new TestSuite("Error Reporting Tests");

		for (String testsDirectory : TEST_DIRS) {

			for (final String fileName : getPDTTFiles(testsDirectory)) {
				try {
					final PdttFile pdttFile = new PdttFile(fileName);
					filesMap.put(pdttFile, null);
					
					suite.addTest(new ErrorReportingTests("/" + fileName) {

						protected void runTest() throws Throwable {
							IFile file = filesMap.get(pdttFile);
							
							StringBuilder buf = new StringBuilder();

							IMarker[] markers = file.findMarkers(DefaultProblem.MARKER_TYPE_PROBLEM, true, IResource.DEPTH_ZERO);
							for (IMarker marker : markers) {
								buf.append("\n[line=");
								buf.append(marker.getAttribute(IMarker.LINE_NUMBER));
								buf.append(", start=");
								buf.append(marker.getAttribute(IMarker.CHAR_START));
								buf.append(", end=");
								buf.append(marker.getAttribute(IMarker.CHAR_END));
								buf.append("] ");
								buf.append(marker.getAttribute(IMarker.MESSAGE)).append('\n');
							}

							assertContents(pdttFile.getExpected(), buf.toString());
						}
					});
				} catch (final Exception e) {
					suite.addTest(new TestCase(fileName) { // dummy test indicating PDTT file parsing failure
							protected void runTest() throws Throwable {
								throw e;
							}
						});
				}
			}
		}

		// Create a setup wrapper
		TestSetup setup = new TestSetup(suite) {
			protected void setUp() throws Exception {
				setUpSuite();
			}

			protected void tearDown() throws Exception {
				tearDownSuite();
			}
		};

		return setup;
	}

