	protected static CompletionProposal[] getProposals(ISourceModule sourceModule, int offset) throws ModelException {
		IStructuredDocument document = (IStructuredDocument) new PHPDocumentLoader().createNewStructuredDocument();
		String content = new String(sourceModule.getSourceAsCharArray());
		document.set(content);
		final List<CompletionProposal> proposals = new LinkedList<CompletionProposal>();
		sourceModule.codeComplete(offset, new TestCompletionRequestor(document, offset) {
			public void accept(CompletionProposal proposal) {
				proposals.add(proposal);
			}
			@Override
			public void completionFailure(IProblem problem) {
				Logger.log(Logger.ERROR, problem.getMessage());
			}
		});
		return proposals.toArray(new CompletionProposal[proposals.size()]);
	}

