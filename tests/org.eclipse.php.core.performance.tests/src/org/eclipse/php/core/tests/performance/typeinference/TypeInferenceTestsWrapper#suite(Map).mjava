	public Test suite(final Map map) {
		project = ResourcesPlugin.getWorkspace().getRoot().getProject(map.get(ProjectSuite.PROJECT).toString());
		perfMonitor = PHPCorePerformanceTests.getPerformanceMonitor();

		TestSuite suite = new TestSuite("Type Inference Tests");

		final PHPVersion phpVersion = (PHPVersion) map.get(ProjectSuite.PHP_VERSION);
		for (String testsDirectory : TESTS.get(phpVersion)) {
			testsDirectory = testsDirectory.replaceAll("project", map.get(ProjectSuite.PROJECT).toString());
			for (final String fileName : getPDTTFiles(testsDirectory,
					PHPCorePerformanceTests.getDefault().getBundle())) {
				try {
					final PdttFile pdttFile = new PdttFile(PHPCorePerformanceTests.getDefault().getBundle(), fileName);
					final String pruner = getPrunerType(pdttFile);

					suite.addTest(new TypeInferenceTests(phpVersion.getAlias() + " - /" + fileName) {

						protected void setUp() throws Exception {
							TestUtils.setProjectPhpVersion(project, phpVersion);
						}

						protected void tearDown() throws Exception {
						}

						protected void runTest() throws Throwable {
							String criteriaFunction = new File(fileName).getName().replaceAll("\\.pdtt", "");
							String code = pdttFile.getFile();

							findEvaluatedType(fileName, code, criteriaFunction, pruner);
						}
					});
				} catch (final Exception e) {
					suite.addTest(new TestCase(fileName) { // dummy
															// test
															// indicating
															// PDTT
															// file
															// parsing
															// failure
						protected void runTest() throws Throwable {
							throw e;
						}
					});
				}
			}
		}

		// Create a setup wrapper
		TestSetup setup = new TestSetup(suite) {
			protected void setUp() throws Exception {
				setUpSuite();
			}

			protected void tearDown() throws Exception {
				tearDownSuite();
			}
		};
		return setup;
	}

