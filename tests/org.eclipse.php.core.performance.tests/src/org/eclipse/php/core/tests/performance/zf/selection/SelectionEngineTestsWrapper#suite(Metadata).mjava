	public Test suite(final Metadata metadata) {
		project = ResourcesPlugin.getWorkspace().getRoot().getProject(
				metadata.project);
		perfMonitor = PHPCorePerformanceTests.getPerformanceMonitor();
		TestSuite suite = new TestSuite("Auto Selection Engine Tests");

		final PHPVersion phpVersion = metadata.phpVersion;
		for (String testsDirectory : TESTS.get(phpVersion)) {
			testsDirectory = testsDirectory.replaceAll("project",
					metadata.project);
			for (final String fileName : getPDTTFiles(testsDirectory,
					PHPCorePerformanceTests.getDefault().getBundle())) {
				try {
					final CodeAssistPdttFile pdttFile = new CodeAssistPdttFile(
							fileName);
					SelectionEngineTests test = new SelectionEngineTests(
							fileName) {

						protected void setUp() throws Exception {
						}

						protected void tearDown() throws Exception {
							if (testFile != null) {
								testFile.delete(true, null);
								testFile = null;
							}
						}

						protected void runTest() throws Throwable {
							perfMonitor.execute(
									"PerformanceTests.testSelectionEngine"
											+ "_" + fileName, new Operation() {
										public void run() throws Exception {
											IModelElement[] elements = getSelection(pdttFile
													.getFile());
										}
									}, 1, 10);
						}
					};
					// test.project = project;
					// test.perfMonitor = perfMonitor;
					suite.addTest(test);
				} catch (final Exception e) {
					suite.addTest(new TestCase(fileName) { // dummy
								// test
								// indicating
								// PDTT
								// file
								// parsing
								// failure
								protected void runTest() throws Throwable {
									throw e;
								}
							});
				}
			}
		}
		return suite;
	}

