	public static Test suite() {

		TestSuite suite = new TestSuite("Semantic Highlighting Tests");
		for (Entry<PHPVersion, String> pair : TESTS.entrySet()) {
			phpVersion = pair.getKey();
			TestSuite phpVerSuite = new TestSuite(phpVersion.getAlias());

			String[] files = getPDTTFiles(pair.getValue(), PHPUiTests
					.getDefault().getBundle());

			for (final String fileName : files) {
				try {
					final PdttFile pdttFile = new PdttFile(PHPUiTests
							.getDefault().getBundle(), fileName);
					phpVerSuite.addTest(new SemanticHighlightingTests(
							phpVersion.getAlias() + " - /" + fileName) {

						protected void setUp() throws Exception {
							PHPCoreTests.setProjectPhpVersion(project,
									PHPVersion.PHP5_3);
						}

						protected void tearDown() throws Exception {
							if (testFile != null) {
								testFile.delete(true, null);
								testFile = null;
							}
						}

						protected void runTest() throws Throwable {
							;
							String result = "";
							createFile(new ByteArrayInputStream(pdttFile
									.getFile().getBytes()));
							ISourceModule module = getSourceModule();
							assertNotNull(module);
							String index = fileName.substring(fileName
									.lastIndexOf('/') + 1, fileName
									.indexOf('.'));
							// System.err.println(index);
							AbstractSemanticHighlighting highlighter = highlighters
									.get(index);
							assertNotNull(highlighter);
							Program program = getProgram(module);
							highlighter.initDefaultPreferences();
							Position[] positions = highlighter
									.consumes(program);
							assertNoDuplicates(highlighter.getDisplayName(),
									positions);
							result += highlighter.getClass().getName() + ":\n";
							for (Position position : positions) {
								result += "highlight("
										+ pdttFile.getFile().substring(
												position.getOffset(),
												position.getOffset()
														+ position.getLength())
										+ ")\n";
							}
							assertEquals(pdttFile.getExpected(), result);
							// We check the other highlighters for failure
							for (AbstractSemanticHighlighting h : highlighters
									.values()) {
								if (h != highlighter) {
									h.initDefaultPreferences();
									positions = h.consumes(program);
									assertNoDuplicates(highlighter
											.getDisplayName(), positions);
								}
							}
						}

						private Program getProgram(ISourceModule module)
								throws ModelException, IOException {
							return SharedASTProvider.getAST(module,
									SharedASTProvider.WAIT_YES, null);

						}
					});
				} catch (final Exception e) {
					phpVerSuite.addTest(new TestCase(fileName) {
						protected void runTest() throws Throwable {
							throw e;
						}
					});
				}
			}
			suite.addTest(phpVerSuite);
		}

		// Create a setup wrapper
		TestSetup setup = new TestSetup(suite) {
			protected void setUp() throws Exception {
				setUpSuite();
			}

			protected void tearDown() throws Exception {
				tearDownSuite();
			}
		};
		return setup;
	}

