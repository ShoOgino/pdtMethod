	protected SQL(Connection con) throws SQLException {
		fConnection= con;

		boolean needsUpgrade= true;
		boolean needsInitialization= true;
		boolean needsFailures= true;
		boolean needsComments= true;

		Statement statement= fConnection.createStatement();
		ResultSet rs= statement.executeQuery("select SYS.SYSTABLES.TABLENAME from SYS.SYSTABLES where SYS.SYSTABLES.TABLENAME not like 'SYS%'"); //$NON-NLS-1$
		while (rs.next()) {
			String tablename= rs.getString(1);
			if ("SUMMARYENTRY".equals(tablename)) //$NON-NLS-1$
				needsUpgrade= false;
			else if ("CONFIG_ORG".equals(tablename)) //$NON-NLS-1$
				fCompatibility= true;
			else if ("VARIATION".equals(tablename)) //$NON-NLS-1$
				needsInitialization= false;
			else if ("FAILURE".equals(tablename)) //$NON-NLS-1$
				needsFailures= false;
			else if ("COMMENT".equals(tablename)) //$NON-NLS-1$
				needsComments= false;
		}
		if (!fCompatibility) {
			// check whether table SAMPLE still has the CONFIG_ID column
			rs= statement.executeQuery("select count(*) from SYS.SYSTABLES, SYS.SYSCOLUMNS where SYS.SYSTABLES.TABLENAME = 'SAMPLE' and " + //$NON-NLS-1$
					"SYS.SYSTABLES.TABLEID = SYS.SYSCOLUMNS.REFERENCEID and SYS.SYSCOLUMNS.COLUMNNAME = 'CONFIG_ID' "); //$NON-NLS-1$
			if (rs.next() && rs.getInt(1) == 1)
				fCompatibility= true;
		}

		if (needsInitialization)
			initialize();
		else {
			if (needsUpgrade)
				upgradeDB();
			else if (needsFailures)
				addFailureTable();
			if (needsComments)
				addCommentTable();
		}
	}

