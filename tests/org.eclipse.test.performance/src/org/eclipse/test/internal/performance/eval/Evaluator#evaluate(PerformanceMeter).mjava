	/*
	 * @see org.eclipse.test.internal.performance.eval.IEvaluator#evaluate(org.eclipse.jdt.ui.tests.performance.PerformanceMeter)
	 */
	public void evaluate(PerformanceMeter performanceMeter) throws RuntimeException {
	    
		if (fCheckers == null)
		    return;	// nothing to do
		
		// get reference build tag
		Variations refKeys= PerformanceTestPlugin.getAssertAgainst();
		if (refKeys == null)
		    return;	// nothing to do
		
	    if (!(performanceMeter instanceof InternalPerformanceMeter))
	        return;	// we cannot handle this.
	    
        InternalPerformanceMeter ipm= (InternalPerformanceMeter) performanceMeter;
	    Sample session= ipm.getSample();
		Assert.assertTrue("metering session is null", session != null); //$NON-NLS-1$
	    String scenarioName= session.getScenarioID();
		
		// determine all dimensions we need
		HashSet allDimensions= new HashSet();
		for (int i= 0; i < fCheckers.length; i++) {
			AssertChecker chk= fCheckers[i];
			Dim[] dims= chk.getDimensions();
			for (int j= 0; j < dims.length; j++)
				allDimensions.add(dims[j]);
		}
		
		// get data for this session
		DataPoint[] sessionDatapoints;
		Variations config= PerformanceTestPlugin.getVariations();
		if (config != null)
		    sessionDatapoints= DB.queryDataPoints(config, scenarioName, allDimensions);
		else
			sessionDatapoints= session.getDataPoints();
	    if (sessionDatapoints == null || sessionDatapoints.length == 0) {
	        PerformanceTestPlugin.logWarning("no session data named '" + config + "' found"); //$NON-NLS-1$ //$NON-NLS-2$
	        return;
	    }

		// get reference data
		DataPoint[] datapoints= DB.queryDataPoints(refKeys, scenarioName, allDimensions);
	    if (datapoints == null || datapoints.length == 0) {
	        PerformanceTestPlugin.logWarning("no reference data named '" + refKeys + "' found"); //$NON-NLS-1$ //$NON-NLS-2$
	        return;
	    }
		
	    // calculate the average
		StatisticsSession referenceStats= new StatisticsSession(datapoints);
		StatisticsSession measuredStats= new StatisticsSession(sessionDatapoints);

		StringBuffer failMesg= new StringBuffer("Performance criteria not met when compared to '" + refKeys + "':"); //$NON-NLS-1$ //$NON-NLS-2$ 
		boolean pass= true;
		for (int i= 0; i < fCheckers.length; i++) {
			AssertChecker chk= fCheckers[i];
			pass &= chk.test(referenceStats, measuredStats, failMesg);
		}
		
		if (!pass) {
		    if (config != null)
		        	DB.markAsFailed(config, session, failMesg.toString());
//		    else
//				Assert.assertTrue(failMesg.toString(), false);
		}
	}

