	private static HttpClient createHttpClient(String url,
			IProxyService proxyService) throws IOException, URISyntaxException {
		HttpClient httpClient = new HttpClient();

		if (proxyService.isProxiesEnabled()) {
			IProxyData[] proxyData = proxyService.select(new URI(url));

			if (proxyData.length != 0) {
				IProxyData proxy = proxyData[0];
				String proxyHostName = proxy.getHost();
				if (proxyHostName != null) {
					int portNumber = proxy.getPort();
					if (portNumber == -1) {
						portNumber = 80;
					}
					httpClient.getHostConfiguration().setProxy(proxyHostName,
							portNumber);
					if (proxy.isRequiresAuthentication()) {
						String userName = proxy.getUserId();
						if (userName != null) {
							String password = proxy.getPassword();
							Credentials credentials = new UsernamePasswordCredentials(
									userName, password);
							httpClient.getState().setProxyCredentials(
									new AuthScope(null, AuthScope.ANY_PORT,
											null, AuthScope.ANY_SCHEME),
									credentials);
						}
					}
				}
			}
		}

		httpClient.getHttpConnectionManager().getParams()
				.setConnectionTimeout(15000);

		return httpClient;
	}

